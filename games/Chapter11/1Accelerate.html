<!doctype html>
<head>
	<meta charset="utf-8">
	<title>Acceleration</title>
<head>
<body>
	<canvas width="550" height="400" style="border: 1px dashed black"></canvas>
	<script src="requestAnimationFramePolyfill.js"></script>
	<script src="Entity.js"></script>
	<script src="Game.js"></script>
	<script type="text/javascript">
		
	//--- The main program
	var game = new Game();

	//The canvas
	var canvas = document.querySelector("canvas"); 
	var drawingSurface = canvas.getContext("2d");
	
	//The cat
	var cat = new Entity();
	cat.x = canvas.width / 2 - cat.halfWidth();
	cat.y = canvas.height / 2 - cat.halfHeight();
	game.sprites.push(cat);

	//Load the tilesheet image
	var image = new Image();
	image.addEventListener("load", loadHandler, false);
	image.src = "cat.png";
	game.assetsToLoad.push(image);
	
	
	//Add keyboard listeners
	window.addEventListener("keydown", function(event)
	{
	  switch(event.keyCode)
	  {
		case game.UP:
			game.moveUp = true;
			break;
		  
		  case game.DOWN:
			game.moveDown = true;
			break;
			
		  case game.LEFT:
			game.moveLeft = true;
			break;  
			
		  case game.RIGHT:
			game.moveRight = true;
			break; 
	  }
	}, false);

	window.addEventListener("keyup", function(event)
	{
	  switch(event.keyCode)
	  {
		case game.UP:
			game.moveUp = false;
			break;
		  
		  case game.DOWN:
			game.moveDown = false;
			break;
			
		  case game.LEFT:
			game.moveLeft = false;
			break;  
			
		  case game.RIGHT:
			game.moveRight = false;
			break; 
	  }
	}, false);

	update();
		
	function update()
	{ 
	  //The animation loop
	  requestAnimationFrame(update, canvas);
	  
	  //Change what the game is doing based on the game state
	  switch(game.gameState)
	  {
		case game.LOADING:
		  console.log("loading...");
		  break;
		
		case game.PLAYING:
		  playGame();
		  break;
	  }
	  
	  //Render the game
	  render();
	}
		
	function loadHandler()
	{ 
		game.assetsLoaded++;
		if(game.assetsLoaded === game.assetsToLoad.length)
		{
			console.log("IM IN HERE");
			game.gameState = game.PLAYING;
			console.log("game.gameState = "+ game.gameState);
		}
	}
		
		function playGame()
	{ 
		//Set the cat's acceleration if the keys are being pressed
		//Up
		if(game.moveUp && !game.moveDown)
		{
			cat.accelerationY = -200.0;
		}
		//Down
		if(game.moveDown && !game.moveUp)
		{
			cat.accelerationY = 200.0;
		}
		//Left
		if(game.moveLeft && !game.moveRight)
		{
			cat.accelerationX = -0.2;
		}
		//Right
		if(game.moveRight && !game.moveLeft)
		{
			cat.accelerationX = 0.2;
		}

		//Set the cat's velocity and acceleration to zero if none of the keys are being pressed
		if(!game.moveUp && !game.moveDown)
		{
			cat.accelerationY = 0;
			cat.vy = 0;
		}
		if(!game.moveLeft && !game.moveRight)
		{
			cat.accelerationX = 0;
			cat.vx = 0;
		}

		//Apply the acceleration
		cat.vx += cat.accelerationX; 
		cat.vy += cat.accelerationY;

		//Limit the speed
		if (cat.vx > cat.speedLimit)
		{
			cat.vx = cat.speedLimit;
		}
		if (cat.vx < -cat.speedLimit)
		{
			cat.vx = -cat.speedLimit;
		}
		if (cat.vy > cat.speedLimit)
		{
			cat.vy = cat.speedLimit;
		} 
		if (cat.vy < -cat.speedLimit)
		{
			cat.vy = -cat.speedLimit;
		}
		
		//Move the cat
		cat.x += cat.vx;
		cat.y += cat.vy;

		//Screen boundaries
		if (cat.x < 0)
		{
			cat.x = 0;
		}
		if (cat.y < 0)
		{
			cat.y = 0;
		}
		if (cat.x + cat.width > canvas.width)
		{
			cat.x = canvas.width - cat.width;
		}
		if (cat.y + cat.height > canvas.height)
		{
			cat.y = canvas.height - cat.height;
		}
	}

	function render()
	{ 
	  drawingSurface.clearRect(0, 0, canvas.width, canvas.height);
	  
	  //Display the game.sprites
	  if(game.sprites.length !== 0)
	  {
		  for(var i = 0; i < game.sprites.length; i++)
		  {
			 var sprite = game.sprites[i];
			 if(sprite.visible)
			 {
				 drawingSurface.drawImage
				 (
				   image, 
				   sprite.sourceX, sprite.sourceY, 
				   sprite.sourceWidth, sprite.sourceHeight,
				   Math.floor(sprite.x), Math.floor(sprite.y), 
				   sprite.width, sprite.height
				 ); 
			 }
		  }
	  }
	}
	
	</script>
</body>