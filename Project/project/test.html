<!DOCTYPE HTML>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<script type="text/javascript" charset="utf-8" src="jquery-1.10.2.js"></script>
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script> 
</head>
<body>
	<form>
		<input type="button" onclick="getLocationUpdate();" value="GPS test"/>
	</form>
	<div id="out"></div>
	<div id="map" style="width:450px; height:300px; border:1px solid #999"></div>

	
	<div>
	<p>Camera<br>
		<h2>Preview:</h2>
	<p>
		<img src="about:blank" alt="" id="show-picture">
	</p>
	<p id="error"></p>
    <input id="take-picture" type="file" accept="video/*,image/*">
	<!--<canvas width="device-width" height="device-height" style="border: 1px dashed black"/>-->
	
	<script>
	var map;
	var marker;
	var defaultLocation = new google.maps.LatLng(33.00, -117.0);

	var watchID;
	var geoLoc;
	var output = document.getElementById("out");
	
	var myOptions = {
		zoom: 10,
		mapTypeId: google.maps.MapTypeId.ROADMAP
	};

	map = new google.maps.Map(document.getElementById("map"), myOptions);
	
	
	map.setCenter(defaultLocation);
	
	addMarker(defaultLocation, "test default marker");
	
	
	function showLocation(position) {
		var latitude = position.coords.latitude;
		var longitude = position.coords.longitude;
		var accuracy = position.coords.accuracy;

		if (accuracy < 50)
		{
			clearWatch();
			console.log("in clear watch");
		}
		
		/*
		var img = new Image();
		img.src = "http://maps.googleapis.com/maps/api/staticmap?center=" + latitude + "," + longitude + "&zoom=13&size=300x300&sensor=false";
		*/
		//output.appendChild(img);
		
		output.innerHTML = '<p>Latitude is ' + latitude + '° <br>Longitude is ' + longitude + '° <br>Accuracy is '+ accuracy +'</p>';
		addMarker(new google.maps.LatLng(position.coords.latitude, position.coords.longitude), "My location");
		
		console.log("HELLO");
	  
	}
	
	function addMarker(latitudeLongitude, titleMarker)
	{
		if(marker) 
			marker.setMap(null); 
		
		marker = new google.maps.Marker({
			position: latitudeLongitude,  
			title: titleMarker
		});
		
		marker.setMap(map);

		map.panTo(latitudeLongitude);
	}

	function errorHandler(err) {
	  if(err.code == 1) {
		alert("Error: Access is denied!");
	  }else if( err.code == 2) {
		alert("Error: Position is unavailable!");
	  }
	}
	
	function getLocationUpdate(){

	   if(navigator.geolocation){
		  // timeout at 60000 milliseconds (60 seconds)
		  var options = {	//frequency:60000, 
							enableHighAccuracy: true
							};
		  geoLoc = navigator.geolocation;
		  
		  watchID = geoLoc.watchPosition (showLocation, 
										 errorHandler, options);
										 								 
	   }else{
		  alert("Sorry, browser does not support geolocation!");
	   }
	}
	
	// stop WatchPostition that was started earlier
	// 
	function clearWatch() {
		if (watchID != null) {
			navigator.geolocation.clearWatch(watchID);
			watchID = null;
		}
	}
	
    var takePicture = document.querySelector("#take-picture"),
        showPicture = document.querySelector("#show-picture");

    if (takePicture && showPicture) {
        // Set events
        takePicture.onchange = function (event) {
            // Get a reference to the taken picture or chosen file
            var files = event.target.files,
                file;
            if (files && files.length > 0) {
                file = files[0];
                try {
                    // Get window.URL object
                    var URL = window.URL || window.webkitURL;

                    // Create ObjectURL
                    var imgURL = URL.createObjectURL(file);

                    // Set img src to ObjectURL
                    showPicture.src = imgURL;

                    // Revoke ObjectURL
                    URL.revokeObjectURL(imgURL);
                }
                catch (e) {
                    try {
                        // Fallback if createObjectURL is not supported
                        var fileReader = new FileReader();
                        fileReader.onload = function (event) {
                            showPicture.src = event.target.result;
                        };
                        fileReader.readAsDataURL(file);
                    }
                    catch (e) {
                        //
                        var error = document.querySelector("#error");
                        if (error) {
                            error.innerHTML = "Neither createObjectURL or FileReader are supported";
                        }
                    }
                }
            }
        };
    }
	</script>
	</div>
</body>