<!DOCTYPE HTML>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<script type="text/javascript" charset="utf-8" src="jquery-1.10.2.js"></script>
</head>
<body>
	<form>
		<input type="button" onclick="getLocationUpdate();" value="GPS test"/>
	</form>
	<div id="out"></div>
	
	<div>
	<p>Camera<br>
		<h2>Preview:</h2>
	<p>
		<img src="about:blank" alt="" id="show-picture">
	</p>
	<p id="error"></p>
    <input id="take-picture" type="file" accept="video/*,image/*">
	<!--<canvas width="device-width" height="device-height" style="border: 1px dashed black"/>-->
	
	<script>
	
	var watchID;
	var geoLoc;
	var output = document.getElementById("out");
	
	function showLocation(position) {
		var latitude = position.coords.latitude;
		var longitude = position.coords.longitude;
		var accuracy = position.coords.accuracy;

		if (accuracy < 50)
		{
			clearWatch();
			console.log("in clear watch");
		}
	
		var img = new Image();
		img.src = "http://maps.googleapis.com/maps/api/staticmap?center=" + latitude + "," + longitude + "&zoom=13&size=300x300&sensor=false";
		output.innerHTML = '<p>Latitude is ' + latitude + '° <br>Longitude is ' + longitude + '° <br>Accuracy is '+ accuracy +'</p>';
		output.appendChild(img);
		console.log("HELLO");
	  
		//alert("Latitude : " + latitude + " Longitude: " + longitude);
	}

	function errorHandler(err) {
	  if(err.code == 1) {
		alert("Error: Access is denied!");
	  }else if( err.code == 2) {
		alert("Error: Position is unavailable!");
	  }
	}
	
	function getLocationUpdate(){

	   if(navigator.geolocation){
		  // timeout at 60000 milliseconds (60 seconds)
		  var options = {	//frequency:60000, 
							enableHighAccuracy: true
							};
		  geoLoc = navigator.geolocation;
		  //watchID = geoLoc.getCurrentPosition (showLocation, 
		//								 errorHandler, options);
		  watchID = geoLoc.watchPosition (showLocation, 
										 errorHandler, options);
										 								 
	   }else{
		  alert("Sorry, browser does not support geolocation!");
	   }
	}
	
	// clear the watch that was started earlier
	// 
	function clearWatch() {
		if (watchID != null) {
			navigator.geolocation.clearWatch(watchID);
			watchID = null;
		}
	}
	
    var takePicture = document.querySelector("#take-picture"),
        showPicture = document.querySelector("#show-picture");

    if (takePicture && showPicture) {
        // Set events
        takePicture.onchange = function (event) {
            // Get a reference to the taken picture or chosen file
            var files = event.target.files,
                file;
            if (files && files.length > 0) {
                file = files[0];
                try {
                    // Get window.URL object
                    var URL = window.URL || window.webkitURL;

                    // Create ObjectURL
                    var imgURL = URL.createObjectURL(file);

                    // Set img src to ObjectURL
                    showPicture.src = imgURL;

                    // Revoke ObjectURL
                    URL.revokeObjectURL(imgURL);
                }
                catch (e) {
                    try {
                        // Fallback if createObjectURL is not supported
                        var fileReader = new FileReader();
                        fileReader.onload = function (event) {
                            showPicture.src = event.target.result;
                        };
                        fileReader.readAsDataURL(file);
                    }
                    catch (e) {
                        //
                        var error = document.querySelector("#error");
                        if (error) {
                            error.innerHTML = "Neither createObjectURL or FileReader are supported";
                        }
                    }
                }
            }
        };
    }
	
	
	/*
		//1. Get a reference to the canvas
		var canvas = document.querySelector("canvas");

		//2. Get a reference to the canvas's drawing surface
		var drawingSurface = canvas.getContext("2d");
		

		var cameraInput = document.getElementById('camerainput');
		cameraInput.addEventListener('change', handleFiles);
		
		var img = new Image;
		
		function handleFiles(e) {
			img.src = URL.createObjectURL(e.target.files[0]);
			img.onload = function() {
				loadHandler();
			}
		}
		*/
		/*
		document.getElementById('camerainput').addEventListener('change', readSingleFile, false);
		var canvas = document.getElementById("camerainput");
		var cc = canvas.getContext("2d");
		
		// Define viewports for scrolling inside the canvas

		/* Viewport x position    view_xview = 0;
		/* Viewport y position    view_yview = 0;
		/* Viewport width         view_wview = 960;
		/* Viewport height        view_hview = 560;
		/* Sector width          room_width = 5000;
		/* Sector height          room_height = 3000;

		canvas.width = view_wview;
		canvas.height = view_hview;
		*/
		
		//4. Add a listener to the image to call the 
		//render function when the image has loaded
		//img.addEventListener("load", loadHandler, false);
	
		/*
		function loadHandler()
		{ 
		
		  //6. Draw the img onto the drawingSurface
		  //drawingSurface.drawImage(img, 20, 20);
		  drawingSurface.drawImage
		  (
			img, 
			0, 0, img.width, img.height,
			0, 0, canvas.width, canvas.height
		  );
		  
		}
		*/
	</script>
	</div>
</body>